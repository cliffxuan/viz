{"version":3,"sources":["TreeSpec.tsx","parser.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["spec","Vertex","id","name","predecessors","successors","this","cache","isAcyclic","Infinity","undefined","cachedValue","result","length","apply","Math","min","map","v","depth","vertex","visited","successor","includes","push","successorPath","pathTo","concat","filter","isDescendant","flatten","descendants","DirectedGraph","vertices","max","isTree","isMultiTree","roots","root","parent","Tree","Error","toPairs","chain","nodes","split","x","trim","zip","slice","useStyles","makeStyles","theme","createStyles","height","display","flexDirection","appBar","backgroundColor","color","saveButton","marginLeft","spacing","main","flexGrow","overflow","padding","pane","paper","palette","text","secondary","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","firestore","App","path","render","match","GraphContainer","docId","params","makeid","characters","charactersLength","i","charAt","floor","random","useState","data","setData","redirect","setRedirect","useEffect","a","collection","doc","get","graph","exists","replace","fetchDoc","to","Graph","handleChange","handleSave","set","classes","multiTrees","pairs","row","reduce","p","nameToVertex","uniq","predecessorName","successorName","predecessorId","successorId","values","parse","className","AppBar","position","elevation","Toolbar","Typography","variant","Button","onClick","Grid","container","item","xs","md","Paper","square","index","tree","fromRoot","width","breadth","E","Vega","key","treeSpec","mode","placeholder","onChange","value","Boolean","window","location","hostname","ReactDOM","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.2f1714c8.chunk.js","sourcesContent":["import { Spec } from 'vega';\n\nconst spec: Spec = {\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"description\": \"An example of Cartesian layouts for a node-link diagram of hierarchical data.\",\n  \"width\": 600,\n  \"height\": 1600,\n  \"padding\": 5,\n\n  \"signals\": [],\n\n  \"data\": [\n    {\n      \"name\": \"tree\",\n      \"transform\": [\n        {\n          \"type\": \"stratify\",\n          \"key\": \"id\",\n          \"parentKey\": \"parent\"\n        },\n        {\n          \"type\": \"tree\",\n          \"method\": \"tidy\",\n          \"size\": [{\"signal\": \"height\"}, {\"signal\": \"width - 100\"}],\n          \"separation\": false,\n          \"as\": [\"y\", \"x\", \"depth\", \"children\"]\n        }\n      ]\n    },\n    {\n      \"name\": \"links\",\n      \"source\": \"tree\",\n      \"transform\": [\n        { \"type\": \"treelinks\" },\n        {\n          \"type\": \"linkpath\",\n          \"orient\": \"horizontal\",\n          \"shape\": \"diagonal\"\n        }\n      ]\n    }\n  ],\n\n  \"scales\": [\n    {\n      \"name\": \"color\",\n      \"type\": \"linear\",\n      \"range\": {\"scheme\": \"magma\"},\n      \"domain\": {\"data\": \"tree\", \"field\": \"depth\"},\n      \"zero\": true\n    }\n  ],\n\n  \"marks\": [\n    {\n      \"type\": \"path\",\n      \"from\": {\"data\": \"links\"},\n      \"encode\": {\n        \"update\": {\n          \"path\": {\"field\": \"path\"},\n          \"stroke\": {\"value\": \"#ccc\"}\n        }\n      }\n    },\n    {\n      \"type\": \"symbol\",\n      \"from\": {\"data\": \"tree\"},\n      \"encode\": {\n        \"enter\": {\n          \"size\": {\"value\": 100},\n          \"stroke\": {\"value\": \"#fff\"}\n        },\n        \"update\": {\n          \"x\": {\"field\": \"x\"},\n          \"y\": {\"field\": \"y\"},\n          \"fill\": {\"scale\": \"color\", \"field\": \"depth\"}\n        }\n      }\n    },\n    {\n      \"type\": \"text\",\n      \"from\": {\"data\": \"tree\"},\n      \"encode\": {\n        \"enter\": {\n          \"text\": {\"field\": \"name\"},\n          \"fontSize\": {\"value\": 9},\n          \"baseline\": {\"value\": \"middle\"}\n        },\n        \"update\": {\n          \"x\": {\"field\": \"x\"},\n          \"y\": {\"field\": \"y\"},\n          \"dx\": {\"signal\": \"datum.children ? -7 : 7\"},\n          \"align\": {\"signal\": \"datum.children ? 'right' : 'left'\"}\n        }\n      }\n    }\n  ]\n}\n\nexport default spec;","import { concat, apply, flatten, zip, slice, uniq, values } from \"ramda\";\n\nexport class Vertex {\n  id: number;\n  name: string;\n  predecessors: Array<Vertex>;\n  successors: Array<Vertex>;\n\n  constructor(\n    id: number,\n    name: string,\n    predecessors?: Array<Vertex>,\n    successors?: Array<Vertex>\n  ) {\n    this.id = id;\n    this.name = name;\n    this.predecessors = predecessors ?? ([] as Vertex[]);\n    this.successors = successors ?? ([] as Vertex[]);\n  }\n\n  depth(cache?: Record<number, number>): number {\n    if (!this.isAcyclic) {\n      return Infinity;\n    }\n    if (cache !== undefined) {\n      const cachedValue = cache[this.id];\n      if (cachedValue !== undefined) {\n        return cachedValue;\n      }\n    }\n    // TODO cyclic\n    const result =\n      this.predecessors.length > 0\n        ? apply(\n            Math.min,\n            this.predecessors.map((v) => v.depth(cache))\n          ) + 1\n        : 1;\n    if (cache !== undefined) {\n      cache[this.id] = result;\n    }\n    return result;\n  }\n\n  pathTo(vertex: Vertex, visited?: Array<Vertex>): Array<Vertex> | null {\n    if (visited === undefined) {\n      visited = [] as Vertex[];\n    }\n    if (this.successors.length === 0) {\n      return null;\n    }\n    for (let successor of this.successors) {\n      if (successor === vertex) {\n        return [this, successor] as Vertex[];\n      }\n      if (visited.includes(successor)) {\n        return null;\n      }\n      visited.push(successor);\n      const successorPath = successor.pathTo(vertex, visited); // recursive\n      if (successorPath === null) {\n        continue;\n      } else {\n        return [this as Vertex].concat(successorPath);\n      }\n    }\n    return null;\n  }\n\n  isDescendant(vertex: Vertex): boolean {\n    if (vertex === this) {\n      return true;\n    }\n    if (\n      vertex.successors.filter((successor) => this.isDescendant(successor))\n        .length > 0\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get descendants(): Array<Vertex> {\n    return this.successors.concat(\n      flatten(this.successors.map((successor) => successor.descendants))\n    );\n  }\n\n  get isAcyclic(): boolean {\n    if (this.pathTo(this) !== null) {\n      return false;\n    }\n    for (let successor of this.successors) {\n      if (!successor.isAcyclic) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nexport class DirectedGraph {\n  vertices: Array<Vertex>;\n\n  constructor(vertices: Array<Vertex>) {\n    this.vertices = vertices;\n  }\n\n  public get depth(): number {\n    if (!this.isAcyclic) {\n      return Infinity;\n    }\n    const cache = {};\n    return apply(\n      Math.max,\n      this.vertices.map((v) => v.depth(cache))\n    );\n  }\n\n  get breadth(): number {\n    return this.vertices.filter((v) => v.successors.length === 0).length;\n  }\n\n  get data(): Array<any> {\n    if (this.isTree || this.isMultiTree) {\n      return this.roots.map((root) =>\n        this.vertices\n          .filter((v) => v.isDescendant(root))\n          .map((v: Vertex) => ({\n            id: v.id,\n            name: v.name,\n            parent: v.predecessors[0]?.id,\n          }))\n      );\n    }\n    return []; // TODO return directed graph\n  }\n\n  get roots(): Array<Vertex> {\n    return this.vertices.filter((v) => v.predecessors.length === 0);\n  }\n\n  get isTree(): boolean {\n    if (this.roots.length !== 1) {\n      return false;\n    }\n    if (this.vertices.filter((v) => v.predecessors.length > 1).length > 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get isMultiTree(): boolean {\n    if (this.roots.length < 2) {\n      return false;\n    }\n    if (this.vertices.filter((v) => v.predecessors.length > 1).length > 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get isAcyclic(): boolean {\n    if (this.vertices.length === 0) {\n      return true;\n    }\n    if (this.roots.length === 0) {\n      return false;\n    }\n    if (this.roots.length === 1) {\n      return this.roots[0].isAcyclic;\n    }\n    return true;\n  }\n}\n\nexport class Tree extends DirectedGraph {\n  constructor(vertices: Array<Vertex>) {\n    super(vertices);\n    if (!this.isTree) {\n      throw new Error(\"invalid tree\");\n    }\n  }\n\n  static fromRoot(root: Vertex): Tree {\n    return new Tree([root].concat(root.descendants));\n  }\n\n  get data(): Array<{ id: number; name: string; predecessors?: number }> {\n    return super.data[0] as Array<{\n      id: number;\n      name: string;\n      predecessors?: number;\n    }>;\n  }\n}\n\nexport function toPairs(chain: string): Array<Array<string>> {\n  const nodes = chain.split(\"->\").map((x: string) => x.trim());\n  return zip(nodes, slice(1, Infinity, nodes));\n}\n\nexport function parse(graph: string): DirectedGraph {\n  const pairs = graph\n    .split(\"\\n\")\n    .map((row) => row.split(\";\"))\n    .reduce(concat, [])\n    .map((p) => p.trim())\n    .filter((p) => p !== \"\")\n    .map(toPairs)\n    .reduce(concat, []);\n  const nameToVertex: Record<string, Vertex> = {};\n  let id = -1;\n  for (const [predecessorName, successorName] of uniq(pairs)) {\n    let predecessorId = nameToVertex[predecessorName]?.id;\n    let successorId = nameToVertex[successorName]?.id;\n\n    if (predecessorId === undefined) {\n      predecessorId = ++id;\n      nameToVertex[predecessorName] = new Vertex(\n        predecessorId,\n        predecessorName\n      );\n    }\n    if (successorId === undefined) {\n      successorId = ++id;\n      nameToVertex[successorName] = new Vertex(successorId, successorName, [\n        nameToVertex[predecessorName],\n      ] as Vertex[]);\n    } else {\n      nameToVertex[successorName].predecessors.push(\n        nameToVertex[predecessorName]\n      );\n    }\n    nameToVertex[predecessorName].successors.push(nameToVertex[successorName]);\n  }\n  return new DirectedGraph(values(nameToVertex));\n}\n","import React, { useState, useEffect } from \"react\";\nimport { makeStyles, createStyles, Theme } from \"@material-ui/core/styles\";\nimport Typography from \"@material-ui/core/Typography\";\nimport { Grid, Paper, AppBar, Toolbar, Button } from \"@material-ui/core\";\nimport SaveOutlinedIcon from \"@material-ui/icons/SaveOutlined\";\nimport { Vega } from \"react-vega\";\nimport AceEditor from \"react-ace\";\nimport firebase from \"firebase/app\";\nimport {\n  HashRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n} from \"react-router-dom\";\nimport \"firebase/firestore\";\nimport treeSpec from \"./TreeSpec\";\nimport { parse, DirectedGraph, Tree } from \"./parser\";\n\nimport \"ace-builds/src-noconflict/theme-github\";\n\nconst useStyles = makeStyles((theme: Theme) => {\n  return createStyles({\n    root: {\n      height: \"100vh\",\n      display: \"flex\",\n      flexDirection: \"column\",\n    },\n    appBar: {\n      backgroundColor: \"#fff\",\n      color: \"#000\",\n    },\n    saveButton: {\n      marginLeft: theme.spacing(6),\n    },\n    main: {\n      flexGrow: 1,\n      flexDirection: \"row-reverse\",\n      overflow: \"auto\",\n      padding: theme.spacing(1),\n    },\n    pane: {\n      height: \"100%\",\n    },\n    paper: {\n      color: theme.palette.text.secondary,\n      height: \"100%\",\n      overflow: \"auto\",\n    },\n  });\n});\n\n// Initialize Firebase\nfirebase.initializeApp({\n  apiKey: \"AIzaSyAcRmmHUN_Yyqd0al0MSvRz82kIbrHvh-8\",\n  authDomain: \"hierarchy-28591.firebaseapp.com\",\n  databaseURL: \"https://hierarchy-28591.firebaseio.com\",\n  projectId: \"hierarchy-28591\",\n  storageBucket: \"hierarchy-28591.appspot.com\",\n  messagingSenderId: \"761635818549\",\n  appId: \"1:761635818549:web:b6d6fecfd7747c6345f57c\",\n  measurementId: \"G-TJJF0BJ57G\",\n});\nconst firestore = firebase.firestore();\n\nexport default function App() {\n  return (\n    <Router>\n      <Switch>\n        <Route\n          path=\"/:docId\"\n          render={({ match }) => <GraphContainer docId={match.params.docId} />}\n        />\n        <Route path=\"/\" render={() => <GraphContainer docId=\"default\" />} />\n      </Switch>\n    </Router>\n  );\n}\n\ntype GraphContainerProps = {\n  docId: string;\n};\n\nfunction makeid(length: number): string {\n  var result = \"\";\n  var characters =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  var charactersLength = characters.length;\n  for (var i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n\nfunction GraphContainer({ docId }: GraphContainerProps) {\n  const [data, setData] = useState(\"\");\n  const [redirect, setRedirect] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchDoc = async () => {\n      const doc = await firestore.collection(\"graphs\").doc(docId).get();\n      const data = doc.data()?.graph;\n      if (!doc.exists || data === null) {\n        setRedirect(\"\");\n      } else {\n        setRedirect(null);\n        setData(data.replace(/\\\\n/gi, \"\\n\"));\n      }\n    };\n    fetchDoc();\n  }, [docId]);\n\n  if (redirect !== null) {\n    return <Redirect to={redirect} />;\n  }\n  return (\n    <Graph\n      data={data}\n      handleChange={setData}\n      handleSave={async (data) => {\n        const id = makeid(6);\n        await firestore.collection(\"graphs\").doc(id).set({ graph: data });\n      }}\n    />\n  );\n}\n\ntype GraphProps = {\n  data: string;\n  handleChange(data: string): void;\n  handleSave(data: string): void;\n};\n\nfunction Graph({ data, handleChange, handleSave }: GraphProps) {\n  const classes = useStyles();\n  const multiTrees: DirectedGraph = parse(data);\n\n  return (\n    <div className={classes.root}>\n      <AppBar position=\"static\" className={classes.appBar} elevation={1}>\n        <Toolbar>\n          <Typography variant=\"h6\">Visualize Hierarchical Data</Typography>\n          <Button\n            className={classes.saveButton}\n            onClick={() => handleSave(data)}\n          >\n            <SaveOutlinedIcon />\n            save\n          </Button>\n        </Toolbar>\n      </AppBar>\n      <Grid container spacing={1} className={classes.main}>\n        <Grid item xs={12} md={8} className={classes.pane}>\n          <Paper variant=\"outlined\" className={classes.paper} square>\n            <>\n              {multiTrees.roots.map((root, index) => {\n                const tree = Tree.fromRoot(root);\n                const depth = tree.depth;\n                const width = depth === Infinity ? 600 : 120 * depth;\n                const breadth = tree.breadth;\n                const space = 30 * Math.E ** (-breadth / 40) + 7;\n                const height = breadth * space;\n                return (\n                  <Vega\n                    key={index}\n                    spec={{ ...treeSpec, width, height }}\n                    data={{ tree: tree.data }}\n                  />\n                );\n              })}\n            </>\n          </Paper>\n        </Grid>\n        <Grid item xs={12} md={4} className={classes.pane}>\n          <Paper variant=\"outlined\" className={classes.paper} square>\n            <AceEditor\n              mode=\"plain_text\"\n              placeholder=\"Root -> Parent -> Child;\"\n              theme=\"github\"\n              onChange={(value) => handleChange(value)}\n              value={data}\n              width=\"100%\"\n              height=\"100%\"\n            />\n          </Paper>\n        </Grid>\n      </Grid>\n    </div>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}